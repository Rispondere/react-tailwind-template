import React, { useState, useEffect } from 'react';
import { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, LineChart, Line, PieChart, Pie, Cell } from 'recharts';
import { TrendingUp, Target, Calendar, DollarSign, Star, Award, Share2, Save, Printer } from 'lucide-react';

const CastIncomeSimulator = () => {
  const [inputs, setInputs] = useState({
    dailyCount: 3,
    pricePerService: 12000,
    workDaysPerMonth: 15,
    monthlyTarget: 500000,
    savingsTarget: 3000000,
    targetPeriod: 12
  });

  const [results, setResults] = useState({});

  useEffect(() => {
    calculateResults();
  }, [inputs]);

  const calculateResults = () => {
    const monthlyIncome = inputs.dailyCount * inputs.pricePerService * inputs.workDaysPerMonth;
    const yearlyIncome = monthlyIncome * 12;
    const targetDifference = inputs.monthlyTarget - monthlyIncome;
    const neededServices = Math.ceil(targetDifference / inputs.pricePerService);
    const savingsMonths = Math.ceil(inputs.savingsTarget / monthlyIncome);
    const achievementRate = (monthlyIncome / inputs.monthlyTarget) * 100;

    setResults({
      monthlyIncome,
      yearlyIncome,
      targetDifference,
      neededServices,
      savingsMonths,
      achievementRate
    });
  };

  const handleInputChange = (field, value) => {
    setInputs(prev => ({
      ...prev,
      [field]: Number(value)
    }));
  };

  const getMotivationMessage = () => {
    const rate = results.achievementRate;
    if (rate >= 100) return "🎉 目標達成！素晴らしいペースです！";
    if (rate >= 80) return "💪 あと少しで目標達成！頑張って！";
    if (rate >= 60) return "📈 良いペースです！継続していきましょう";
    return "🚀 まだまだ伸びしろがあります！一緒に頑張りましょう";
  };

  const getLevelInfo = () => {
    const monthly = results.monthlyIncome;
    if (monthly >= 800000) return { level: "プラチナ", color: "#8B5CF6", icon: "👑" };
    if (monthly >= 600000) return { level: "ゴールド", color: "#F59E0B", icon: "⭐" };
    if (monthly >= 400000) return { level: "シルバー", color: "#6B7280", icon: "💎" };
    return { level: "ブロンズ", color: "#F97316", icon: "🔥" };
  };

  // チャート用データ
  const monthlyData = Array.from({ length: 12 }, (_, i) => ({
    month: `${i + 1}月`,
    income: results.monthlyIncome,
    target: inputs.monthlyTarget
  }));

  const yearlyProjection = Array.from({ length: 5 }, (_, i) => ({
    year: `${i + 1}年目`,
    savings: results.monthlyIncome * 12 * (i + 1)
  }));

  const workStyleData = [
    { name: '本指名', value: 40, color: '#F59E0B' },
    { name: '新規', value: 35, color: '#EF4444' },
    { name: 'フリー', value: 15, color: '#10B981' },
    { name: 'イベント', value: 10, color: '#8B5CF6' }
  ];

  const levelInfo = getLevelInfo();

  const handleShare = () => {
    const text = `💰 収入シミュレーション結果\n月収: ¥${results.monthlyIncome?.toLocaleString()}\n目標達成率: ${results.achievementRate?.toFixed(1)}%\nランク: ${levelInfo.level}`;
    if (navigator.share) {
      navigator.share({
        title: 'キャスト収入プランシミュレーター',
        text: text
      });
    } else {
      navigator.clipboard.writeText(text);
      alert('結果をクリップボードにコピーしました！');
    }
  };

  const handleSave = () => {
    const data = {
      inputs,
      results,
      timestamp: new Date().toISOString()
    };
    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `income_simulation_${new Date().toISOString().split('T')[0]}.json`;
    a.click();
    URL.revokeObjectURL(url);
  };

  const handlePrint = () => {
    window.print();
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-amber-50 via-white to-orange-50">
      {/* ヘッダー */}
      <div className="bg-gradient-to-r from-amber-400 to-orange-500 text-white py-6 px-4 shadow-lg">
        <div className="max-w-6xl mx-auto text-center">
          <h1 className="text-3xl font-bold mb-2">💰 キャスト収入プランシミュレーター</h1>
          <p className="text-lg opacity-90">あなたの未来収入をシミュレーション！</p>
        </div>
      </div>

      <div className="max-w-6xl mx-auto p-4 space-y-6">
        {/* 入力セクション */}
        <div className="bg-white rounded-2xl shadow-xl p-6">
          <h2 className="text-2xl font-bold text-gray-800 mb-6 flex items-center">
            <TrendingUp className="mr-3 text-amber-500" />
            収入設定
          </h2>
          
          <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
            <div className="space-y-2">
              <label className="block text-sm font-semibold text-gray-700">1日の平均本数</label>
              <input
                type="number"
                value={inputs.dailyCount}
                onChange={(e) => handleInputChange('dailyCount', e.target.value)}
                className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-amber-400 focus:outline-none text-lg"
                min="1"
                max="20"
              />
              <div className="text-xs text-gray-500">1〜20本</div>
            </div>

            <div className="space-y-2">
              <label className="block text-sm font-semibold text-gray-700">1本あたりのバック額（円）</label>
              <input
                type="number"
                value={inputs.pricePerService}
                onChange={(e) => handleInputChange('pricePerService', e.target.value)}
                className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-amber-400 focus:outline-none text-lg"
                min="1000"
                step="1000"
              />
              <div className="text-xs text-gray-500">1,000円〜</div>
            </div>

            <div className="space-y-2">
              <label className="block text-sm font-semibold text-gray-700">月の出勤日数</label>
              <input
                type="range"
                value={inputs.workDaysPerMonth}
                onChange={(e) => handleInputChange('workDaysPerMonth', e.target.value)}
                className="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"
                min="5"
                max="30"
              />
              <div className="text-center text-lg font-bold text-amber-600">{inputs.workDaysPerMonth}日</div>
            </div>

            <div className="space-y-2">
              <label className="block text-sm font-semibold text-gray-700">月の目標金額（円）</label>
              <input
                type="number"
                value={inputs.monthlyTarget}
                onChange={(e) => handleInputChange('monthlyTarget', e.target.value)}
                className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-amber-400 focus:outline-none text-lg"
                min="100000"
                step="50000"
              />
              <div className="text-xs text-gray-500">目標月収を入力</div>
            </div>

            <div className="space-y-2">
              <label className="block text-sm font-semibold text-gray-700">貯金目標（円）</label>
              <input
                type="number"
                value={inputs.savingsTarget}
                onChange={(e) => handleInputChange('savingsTarget', e.target.value)}
                className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-amber-400 focus:outline-none text-lg"
                min="500000"
                step="100000"
              />
              <div className="text-xs text-gray-500">将来の貯金目標</div>
            </div>

            <div className="space-y-2">
              <label className="block text-sm font-semibold text-gray-700">目標期間（ヶ月）</label>
              <select
                value={inputs.targetPeriod}
                onChange={(e) => handleInputChange('targetPeriod', e.target.value)}
                className="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-amber-400 focus:outline-none text-lg"
              >
                <option value={6}>6ヶ月</option>
                <option value={12}>1年</option>
                <option value={24}>2年</option>
                <option value={36}>3年</option>
              </select>
            </div>
          </div>
        </div>

        {/* 結果表示セクション */}
        <div className="grid lg:grid-cols-2 gap-6">
          {/* 月収シミュレーション */}
          <div className="bg-white rounded-2xl shadow-xl p-6">
            <h3 className="text-xl font-bold text-gray-800 mb-4 flex items-center">
              <DollarSign className="mr-2 text-green-500" />
              月収シミュレーション
            </h3>
            
            <div className="text-center mb-6">
              <div className="text-4xl font-bold text-green-600 mb-2">
                ¥{results.monthlyIncome?.toLocaleString()}
              </div>
              <div className="text-gray-600">予想月収</div>
              <div className="text-sm text-gray-500 mt-1">
                {inputs.dailyCount}本 × ¥{inputs.pricePerService?.toLocaleString()} × {inputs.workDaysPerMonth}日
              </div>
            </div>

            <div className="space-y-3">
              <div className="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                <span>目標との差額</span>
                <span className={`font-bold ${results.targetDifference < 0 ? 'text-green-600' : 'text-red-500'}`}>
                  {results.targetDifference < 0 ? '+' : '-'}¥{Math.abs(results.targetDifference)?.toLocaleString()}
                </span>
              </div>

              {results.targetDifference > 0 && (
                <div className="p-3 bg-amber-50 border-l-4 border-amber-400">
                  <p className="text-amber-800">
                    💡 目標達成まで<strong>あと{results.neededServices}本</strong>必要です！
                  </p>
                </div>
              )}

              <div className="flex justify-between items-center p-3 bg-blue-50 rounded-lg">
                <span>達成率</span>
                <span className="font-bold text-blue-600">{results.achievementRate?.toFixed(1)}%</span>
              </div>

              <div className="w-full bg-gray-200 rounded-full h-4">
                <div 
                  className="bg-gradient-to-r from-green-400 to-blue-500 h-4 rounded-full transition-all duration-1000 flex items-center justify-end pr-2"
                  style={{ width: `${Math.min(results.achievementRate, 100)}%` }}
                >
                  <span className="text-xs text-white font-bold">
                    {results.achievementRate >= 10 ? `${results.achievementRate?.toFixed(0)}%` : ''}
                  </span>
                </div>
              </div>
            </div>
          </div>

          {/* レベル・モチベーション */}
          <div className="bg-white rounded-2xl shadow-xl p-6">
            <h3 className="text-xl font-bold text-gray-800 mb-4 flex items-center">
              <Award className="mr-2 text-purple-500" />
              あなたのレベル
            </h3>

            <div className="text-center mb-6">
              <div className="text-6xl mb-2">{levelInfo.icon}</div>
              <div className="text-2xl font-bold mb-2" style={{ color: levelInfo.color }}>
                {levelInfo.level}ランク
              </div>
              <div className="text-gray-600">現在の収入レベル</div>
              
              <div className="mt-4 grid grid-cols-2 gap-2 text-sm">
                <div className="p-2 bg-orange-50 rounded">
                  <div className="font-bold text-orange-600">ブロンズ</div>
                  <div className="text-xs">〜40万</div>
                </div>
                <div className="p-2 bg-gray-50 rounded">
                  <div className="font-bold text-gray-600">シルバー</div>
                  <div className="text-xs">40-60万</div>
                </div>
                <div className="p-2 bg-yellow-50 rounded">
                  <div className="font-bold text-yellow-600">ゴールド</div>
                  <div className="text-xs">60-80万</div>
                </div>
                <div className="p-2 bg-purple-50 rounded">
                  <div className="font-bold text-purple-600">プラチナ</div>
                  <div className="text-xs">80万〜</div>
                </div>
              </div>
            </div>

            <div className="bg-gradient-to-r from-purple-100 to-pink-100 p-4 rounded-lg mb-4">
              <p className="text-center text-lg font-semibold text-purple-800">
                {getMotivationMessage()}
              </p>
            </div>

            <div className="space-y-2">
              <div className="flex justify-between text-sm text-gray-600">
                <span>貯金目標まで</span>
                <span>{results.savingsMonths}ヶ月</span>
              </div>
              <div className="w-full bg-gray-200 rounded-full h-3">
                <div 
                  className="bg-gradient-to-r from-purple-400 to-pink-400 h-3 rounded-full transition-all duration-500"
                  style={{ width: `${Math.min((results.monthlyIncome * results.savingsMonths / inputs.savingsTarget) * 100, 100)}%` }}
                ></div>
              </div>
              <div className="text-xs text-gray-500 text-center">
                年間貯金: ¥{(results.monthlyIncome * 12)?.toLocaleString()}
              </div>
            </div>
          </div>
        </div>

        {/* グラフセクション */}
        <div className="grid lg:grid-cols-2 gap-6">
          {/* 年間収入推移 */}
          <div className="bg-white rounded-2xl shadow-xl p-6">
            <h3 className="text-xl font-bold text-gray-800 mb-4 flex items-center">
              📊 年間収入推移
            </h3>
            <ResponsiveContainer width="100%" height={300}>
              <BarChart data={monthlyData}>
                <CartesianGrid strokeDasharray="3 3" stroke="#f0f0f0" />
                <XAxis 
                  dataKey="month" 
                  tick={{ fontSize: 12 }}
                  axisLine={{ stroke: '#e0e0e0' }}
                />
                <YAxis 
                  tick={{ fontSize: 12 }}
                  tickFormatter={(value) => `¥${(value / 10000).toFixed(0)}万`}
                  axisLine={{ stroke: '#e0e0e0' }}
                />
                <Tooltip 
                  formatter={(value, name) => [
                    `¥${value.toLocaleString()}`, 
                    name === 'income' ? '予想収入' : '目標金額'
                  ]}
                  labelStyle={{ color: '#374151' }}
                  contentStyle={{ 
                    backgroundColor: '#f9fafb', 
                    border: '1px solid #e5e7eb',
                    borderRadius: '8px'
                  }}
                />
                <Bar dataKey="income" fill="#F59E0B" name="予想収入" radius={[4, 4, 0, 0]} />
                <Bar dataKey="target" fill="#EF4444" opacity={0.7} name="目標金額" radius={[4, 4, 0, 0]} />
              </BarChart>
            </ResponsiveContainer>
            <div className="text-center text-sm text-gray-600 mt-2">
              年収: ¥{results.yearlyIncome?.toLocaleString()}
            </div>
          </div>

          {/* 累積貯金推移 */}
          <div className="bg-white rounded-2xl shadow-xl p-6">
            <h3 className="text-xl font-bold text-gray-800 mb-4 flex items-center">
              📈 貯金推移（5年計画）
            </h3>
            <ResponsiveContainer width="100%" height={300}>
              <LineChart data={yearlyProjection}>
                <CartesianGrid strokeDasharray="3 3" stroke="#f0f0f0" />
                <XAxis 
                  dataKey="year" 
                  tick={{ fontSize: 12 }}
                  axisLine={{ stroke: '#e0e0e0' }}
                />
                <YAxis 
                  tick={{ fontSize: 12 }}
                  tickFormatter={(value) => `¥${(value / 10000).toFixed(0)}万`}
                  axisLine={{ stroke: '#e0e0e0' }}
                />
                <Tooltip 
                  formatter={(value) => [`¥${value.toLocaleString()}`, '累積貯金']}
                  labelStyle={{ color: '#374151' }}
                  contentStyle={{ 
                    backgroundColor: '#f0fdf4', 
                    border: '1px solid #dcfce7',
                    borderRadius: '8px'
                  }}
                />
                <Line 
                  type="monotone" 
                  dataKey="savings" 
                  stroke="#10B981" 
                  strokeWidth={3}
                  dot={{ fill: '#10B981', strokeWidth: 2, r: 6 }}
                  activeDot={{ r: 8, stroke: '#10B981', strokeWidth: 2, fill: '#ffffff' }}
                />
              </LineChart>
            </ResponsiveContainer>
            <div className="text-center text-sm text-gray-600 mt-2">
              5年後予想貯金: ¥{(results.monthlyIncome * 12 * 5)?.toLocaleString()}
            </div>
          </div>
        </div>

        {/* 収入内訳（円グラフ） */}
        <div className="bg-white rounded-2xl shadow-xl p-6">
          <h3 className="text-xl font-bold text-gray-800 mb-4 flex items-center">
            🥧 理想的な収入内訳（参考）
          </h3>
          <div className="grid md:grid-cols-2 gap-6">
            <ResponsiveContainer width="100%" height={300}>
              <PieChart>
                <Pie
                  data={workStyleData}
                  cx="50%"
                  cy="50%"
                  innerRadius={60}
                  outerRadius={120}
                  paddingAngle={5}
                  dataKey="value"
                >
                  {workStyleData.map((entry, index) => (
                    <Cell key={`cell-${index}`} fill={entry.color} />
                  ))}
                </Pie>
                <Tooltip formatter={(value) => [`${value}%`, '']} />
              </PieChart>
            </ResponsiveContainer>
            <div className="flex flex-col justify-center space-y-3">
              {workStyleData.map((item, index) => (
                <div key={index} className="flex items-center space-x-3">
                  <div 
                    className="w-4 h-4 rounded-full" 
                    style={{ backgroundColor: item.color }}
                  ></div>
                  <span className="text-sm font-medium">{item.name}</span>
                  <span className="text-sm text-gray-500">{item.value}%</span>
                </div>
              ))}
              <div className="mt-4 p-3 bg-blue-50 rounded-lg">
                <p className="text-sm text-blue-800">
                  💡 本指名を増やすことで安定した収入が期待できます
                </p>
              </div>
            </div>
          </div>
        </div>

        {/* 目標達成のためのアドバイス */}
        <div className="bg-white rounded-2xl shadow-xl p-6">
          <h3 className="text-xl font-bold text-gray-800 mb-4 flex items-center">
            <Target className="mr-2 text-pink-500" />
            目標達成のためのアドバイス
          </h3>
          <div className="grid md:grid-cols-2 gap-6">
            <div className="space-y-4">
              <div className="p-4 bg-green-50 border-l-4 border-green-400 rounded">
                <h4 className="font-bold text-green-800 mb-2">📈 収入アップのコツ</h4>
                <ul className="text-sm text-green-700 space-y-1">
                  <li>• 本指名のお客様を大切にする</li>
                  <li>• 接客スキルを磨き続ける</li>
                  <li>• 出勤日数を安定させる</li>
                  <li>• イベント時は積極的に参加</li>
                </ul>
              </div>
              <div className="p-4 bg-blue-50 border-l-4 border-blue-400 rounded">
                <h4 className="font-bold text-blue-800 mb-2">💰 貯金のコツ</h4>
                <ul className="text-sm text-blue-700 space-y-1">
                  <li>• 収入の20-30%を自動積立</li>
                  <li>• 家計簿をつけて支出を管理</li>
                  <li>• 将来の目標を明確にする</li>
                  <li>• 投資についても勉強する</li>
                </ul>
              </div>
            </div>
            <div className="space-y-4">
              <div className="p-4 bg-purple-50 border-l-4 border-purple-400 rounded">
                <h4 className="font-bold text-purple-800 mb-2">⚖️ ワークライフバランス</h4>
                <ul className="text-sm text-purple-700 space-y-1">
                  <li>• 適度な休息を取る</li>
                  <li>• 健康管理を怠らない</li>
                  <li>• プライベートも充実させる</li>
                  <li>• 将来のキャリアプランを考える</li>
                </ul>
              </div>
              <div className="p-4 bg-orange-50 border-l-4 border-orange-400 rounded">
                <h4 className="font-bold text-orange-800 mb-2">🎯 目標設定のポイント</h4>
                <ul className="text-sm text-orange-700 space-y-1">
                  <li>• 現実的で達成可能な目標設定</li>
                  <li>• 短期・中期・長期に分けて考える</li>
                  <li>• 定期的に見直しを行う</li>
                  <li>• 達成したらご褒美を設ける</li>
                </ul>
              </div>
            </div>
          </div>
        </div>

        {/* アクションボタン */}
        <div className="bg-white rounded-2xl shadow-xl p-6">
          <h3 className="text-xl font-bold text-gray-800 mb-4 text-center">シミュレーション結果を活用</h3>
          <div className="flex flex-wrap gap-4 justify-center">
            <button 
              onClick={handleShare}
              className="bg-gradient-to-r from-blue-500 to-blue-600 text-white px-6 py-3 rounded-lg font-semibold hover:from-blue-600 hover:to-blue-700 transition-all transform hover:scale-105 flex items-center space-x-2"
            >
              <Share2 size={20} />
              <span>📱 結果を共有</span>
            </button>
            <button 
              onClick={handleSave}
              className="bg-gradient-to-r from-green-500 to-green-600 text-white px-6 py-3 rounded-lg font-semibold hover:from-green-600 hover:to-green-700 transition-all transform hover:scale-105 flex items-center space-x-2"
            >
              <Save size={20} />
              <span>💾 データ保存</span>
            </button>
            <button 
              onClick={handlePrint}
              className="bg-gradient-to-r from-purple-500 to-purple-600 text-white px-6 py-3 rounded-lg font-semibold hover:from-purple-600 hover:to-purple-700 transition-all transform hover:scale-105 flex items-center space-x-2"
            >
              <Printer size={20} />
              <span>🖨️ 印刷する</span>
            </button>
          </div>
          <div className="text-center text-sm text-gray-500 mt-4">
            ※ シミュレーション結果は参考値です。実際の収入を保証するものではありません。
          </div>
        </div>

        {/* フッター */}
        <div className="text-center text-gray-500 text-sm py-4">
          <p>© 2025 キャスト収入プランシミュレーター - あなたの未来をサポート</p>
        </div>
      </div>
    </div>
  );
};

export default CastIncomeSimulator;